<h1 align="center" style="max-width: 100%;">
  <img width="1100" alt="Logo" src="README.assets/Logo.png" style="max-width: 100%;" /><br/>
  <a href="https://www.prismfilmstudio.com">www.prismfilmstudio.com(ë°°í¬ì¤‘ì§€)</a>
</h1>



<h3 align="center">
 í”„ë¡œì íŠ¸ ìµœìš°ìˆ˜ìƒ (1ë“±) ìˆ˜ìƒ - ì‚¼ì„±ì „ì<br /></h3>



###                                  

<p align="center">
  <b>SSAFY 1í•™ê¸° ìµœì¢… í”„ë¡œì íŠ¸(21.11.17 ~ 21.11.24)</b><br /></p>


<p align="center">
  <b>Supported</b><br/>
  <a href="#"><img width="45" src="https://blog.kakaocdn.net/dn/cVaSOX/btqD9jVw36X/jHpIEqn2EAk7xdKMMmpEP0/img.png" alt="C#" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://filestore.community.support.microsoft.com/api/images/a7899ec5-bd4c-4b38-9233-173397ef577f?upload=true" alt="Python" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Python-logo-notext.svg/768px-Python-logo-notext.svg.png" alt="JS" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/1200px-Unofficial_JavaScript_logo_2.svg.png" alt="Preact" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://media.vlpt.us/images/ec532/post/bc893d61-4eaa-4f8f-9b2c-e2d2143506a4/aws_ec2.svg" alt="EC2" /></a>
</p>


<table style="table-layout: fixed; overflow-wrap: break-word;">
  <tbody>
    <tr>
      <td><a href="#" target="_blank"><img width="500" src="README.assets/voice.gif" alt="iPhone demo" style="max-width: 100%;" /></a></td>
      <td><a href="#" target="_blank"><img width="500" src="README.assets/choice.gif" alt="Music app demo" style="max-width: 100%;" /></a></td>
      <td rowspan="2" style="display:flex-column;"><img height="250" src="README.assets/detail3.gif" alt="Full page demo" style="max-width: 100%;" /><div style="height:15px;"></div></div><img height="250" src="README.assets/draw5.png" alt="Full page demo" style="max-width: 100%;" /></td>
    </tr>
    <tr>
      <td colspan="2"><a href="#" target="_blank"><img width="1000" src="README.assets/main5.png" alt="Parallax demo" style="max-width: 100%;" /></a></td>
    </tr>
  </tbody>
</table>
<h6 align="center">
  www.prismfilmstudio.com <a href="#"></a>
</h6>





-----


## âœ¨ Stack

#### ì£¼ìš”  Stack

|                        Content                         |           Main            |                          Detail                          |
| :----------------------------------------------------: | :-----------------------: | :------------------------------------------------------: |
|               [**ìŒì„±ì¸ì‹**](#ìŒì„±ì¸ì‹ )               | Python 3.9.6 / JavaScript |             webkitSpeechRecognition / Axios              |
|                 [**ë“œë¡œì‰**](#ë“œë¡œì‰)                  |        JavaScript         |                Canvas / Blob Data/ Axios                 |
|                       [**FE**]()                       |  HTML / CSS / JavaScript  |            Django 3.2.9 / HTML5 / CSS3 / ES6             |
|         [**í´ëŸ¬ìŠ¤í„°ë§**](#ìƒ‰ì±„-ë°ì´í„°-ë§Œë“¤ê¸°)          |  C# .Net Framework 4.7.2  |            C#(OpenCvSharp4 - V4.5.3.20210817)            |
| [**RGB Calculating**](#ì•Œê³ ë¦¬ì¦˜-êµ¬ì„±-ë°-ì›¹í˜ì´ì§€-ì‘ì—…) |       Python 3.9.6        |                       Python(Math)                       |
|                     [**DB**](#db)                      |       Python 3.9.6        |                    Python(Shell_plus)                    |
|           [**Query ìµœì í™”**](#query-ìµœì í™”)            |       Django 3.2.9        |      prefetch_related / annotate / filter / exclude      |
|                   [**ë°°í¬**](#ë°°í¬)                    |            AWS            | EC2(Ubuntu Server 18.04 LTS) / Cloud9 / Gunicorn / NGINX |



#### ê¸°ë³¸ Stack

|       ent        |      Page       |                         Description                          |
| :--------------: | :-------------: | :----------------------------------------------------------: |
|       User       |    accounts/    |                 íšŒì›ê°€ì… / ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ                 |
|   ì˜ˆê³ í¸ ë³´ê¸°    |     detail/     |          ì˜í™” í¬ìŠ¤í„° ëˆ„ë¥¼ ì‹œ, ì˜ˆê³ í¸ íŒì—… ìë™ì¬ìƒ           |
|   ìƒ‰ì±„ ê³ ë¥´ê¸°    |     choice/     |                  ì¶”ì²œ ë°›ê³  ì‹¶ì€ ìƒ‰ì±„ ê³ ë¥´ê¸°                  |
|   í‰ì ìˆœ ì •ë ¬    |      base/      | TMDB í‰ì  ìˆœìœ¼ë¡œ ì •ë ¬ / í•œì¤„í‰\|ë¦¬ë·° ë‚¨ê¸¸ì‹œ ì¶”ì²œ ì•ˆí•˜ë„ë¡ êµ¬ì„± |
|   ìµœì‹ ìˆœ ì •ë ¬    |      base/      | ê°œë´‰ì¼ ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬ / í•œì¤„í‰\|ë¦¬ë·° ë‚¨ê¸¸ì‹œ ì¶”ì²œ ì•ˆí•˜ë„ë¡ êµ¬ì„± |
| ì´ì „ ìƒ‰ì±„ë¡œ ì •ë ¬ |      base/      | AI Z Score ìˆœìœ¼ë¡œ ì •ë ¬ / í•œì¤„í‰\|ë¦¬ë·° ë‚¨ê¸¸ì‹œ ì¶”ì²œ ì•ˆí•˜ë„ë¡ êµ¬ì„± |
| ì‚¬ìš©ì í‰ê·  í‰ì  |     detail/     |        ì˜í™”ì— ëŒ€í•´ ìœ ì €ê°€ ë‚¨ê¸´ í‰ê·  í‰ì  ê³„ì‚° ë° ì¶œë ¥        |
| ì˜í™” í‚¤ì›Œë“œ ê²€ìƒ‰ |      base/      | ê²€ìƒ‰ ê¸°ëŠ¥ìœ¼ë¡œ ì œëª© > ë‚´ìš©ì— í‚¤ì›Œë“œ í¬í•¨ì—¬ë¶€ì— ë”°ë¼ ì •ë ¬í•´ì„œ ì¶œë ¥ |
|   í€´ì¦ˆ ë§Œë“¤ê¸°    |  quiz_create/   |      ì‚¬ìš©ìê°€ ì˜í™”ì— ëŒ€í•œ ê·¸ë¦¼ í€´ì¦ˆë¥¼ ë‚¼ ìˆ˜ ìˆë„ë¡ êµ¬ì„±      |
|    í€´ì¦ˆ í’€ê¸°     |      quiz/      | ì‚¬ìš©ìë“¤ë¼ë¦¬ ë¬¸ì œë¥¼ í’€ê³  í‹°ì–´ì— ëŒ€í•œ ì ìˆ˜ë¥¼ ì–»ì„ ìˆ˜ ìˆë„ë¡ êµ¬ì„± |
|  í‰ì  ë° í•œì¤„í‰  | movie_comment/  |       ì˜í™”ì— ëŒ€í•œ ë³„ì ê³¼ í•œì¤„í‰ì„ ë‚¨ê¸¸ ìˆ˜ ìˆë„ë¡ êµ¬ì„±        |
|   ë¦¬ë·°(+ê·¸ë¦¼)    |     review/     |           ê·¸ë¦¼ì„ ê·¸ë¦¬ë©° ë¦¬ë·°ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆë„ë¡ êµ¬ì„±           |
|   ë¦¬ë·° ì† ëŒ“ê¸€   | review_comment/ |             ë¦¬ë·°ë§ˆë‹¤ ëŒ“ê¸€ì„ ë‚¨ê¸¸ ìˆ˜ ìˆë„ë¡ êµ¬ì„±              |
|    ìœ ì € í‹°ì–´     |      tier/      | ë¸Œë¡ ì¦ˆë¶€í„° ë§ˆìŠ¤í„°ê¹Œì§€ ë¦¬ë·° ì‘ì„±, ë¬¸ì œ í’€ì´ ë“±ì—ì„œ ì ìˆ˜ íšë“  |
| ì˜í™” Frame í™•ëŒ€  |     detail/     | detail í˜ì´ì§€ì—ì„œ ì˜í™”ì— ëŒ€í•œ í”„ë ˆì„ í´ë¦­ì‹œ  Modalë¡œ í™•ëŒ€ ì¶œë ¥ |



## ğŸ“¦ Structure

![erd](README.assets/erd-7816882.png)

```
final-pjt
â”œâ”€â”€ accounts/
â”‚   â”œâ”€â”€ migrations
â”‚		â”‚		â””â”€â”€ ...
â”‚   â”œâ”€â”€ templates/accounts
â”‚		â”‚		â””â”€â”€ ...
â”‚   â””â”€â”€ static/accounts
â”‚				â””â”€â”€ ...
â”œâ”€â”€ movies/
â”‚   â”œâ”€â”€ migrations
â”‚		â”‚		â””â”€â”€ ...
â”‚   â”œâ”€â”€ templates/movies
â”‚		â”‚		â””â”€â”€ ...
â”‚   â””â”€â”€ static/movies
â”‚				â””â”€â”€ ...
â”œâ”€â”€ final-pjt/
â”‚		â””â”€â”€ ...
â”œâ”€â”€ staticfiles/static
â”‚   â”œâ”€â”€ css
â”‚		â”‚		â””â”€â”€ ...
â”‚   â”œâ”€â”€ favicon
â”‚		â”‚		â””â”€â”€ ...
â”‚   â”œâ”€â”€ images
â”‚		â”‚		â””â”€â”€ ...
â”‚   â”œâ”€â”€ videos
â”‚		â”‚		â””â”€â”€ ...				
â”‚   â””â”€â”€ ...
â”œâ”€â”€ templates
â”‚   â””â”€â”€ base.html
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ db.sqlite3
â””â”€â”€ requirements.txt
```



## ğŸƒ íŒ€ì› ì •ë³´ ë° ì—…ë¬´ ë¶„ë‹´ ë‚´ì—­
#### ì†Œì†
* ##### SSAFY

#### ì´ë¦„
- ##### Eora

  - í´ëŸ¬ìŠ¤í„°ë§ / RGB Calculating / Tier / Quiz / DB / ì¿¼ë¦¬ ìµœì í™” / FE 

- ##### Gkuer

  - ìŒì„±ì¸ì‹ / ë“œë¡œì‰ / Design / Quiz / DB / FE / ì¿¼ë¦¬ ìµœì í™” / ë°°í¬




## âš™ï¸ ê°œìš”

* ##### ëª©í‘œ ì„œë¹„ìŠ¤ êµ¬í˜„ ë° ì‹¤ì œ êµ¬í˜„ ì •ë„

  * 90%
    * ëª©í‘œ ì„œë¹„ìŠ¤ êµ¬í˜„
    * ëª©í‘œ ë””ìì¸ êµ¬í˜„
    * ì†ë„: -10%, ì¿¼ë¦¬ ìµœì í™”, Static ë° DB ê²½ëŸ‰í™” ì™„ë£Œí•˜ì˜€ì§€ë§Œ, ë“œë¡œì‰ì— í™œìš©ë˜ëŠ” Media Fileì— ëŒ€í•œ ê²½ëŸ‰í™”ê°€ ì´ë£¨ì–´ì§€ì§€ ì•ŠìŒ

* ##### ëª©ì°¨

  * Part 1, Eora
  * Part 2, Gkuer
  * ë§ˆì¹˜ë©°



## ğŸƒ Part 2, Gkuer

> SSAFY 1í•™ê¸°ì˜ ë§ˆë¬´ë¦¬, SSAFYì—ì„œ ì²˜ìŒí•˜ëŠ” í”„ë¡œì íŠ¸,
>
> ì˜í•˜ê³  ì‹¶ì—ˆë‹¤. ì›í•˜ëŠ” ëª¨ë“  ê²ƒì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì§‘ì¤‘í–ˆë‹¤.



### `ìŒì„±ì¸ì‹`

> ê¸°ì¡´ì—ëŠ” ë„¤ì´ë²„, ì¹´ì¹´ì˜¤ ë‘˜ ì¤‘ í•˜ë‚˜ì˜ APIë¥¼ ì‚¬ìš©í•´ì„œ Axios, Promise ë°©ì‹ìœ¼ë¡œ API / Django View 2ê°œì™€ í†µì‹ í•˜ì—¬ ë¡œì§ì„ ì²˜ë¦¬í•˜ë ¤ê³  êµ¬ìƒ
>
> í•˜ì§€ë§Œ, IEì™€ Chromeì—ì„œ ë™ì‘í•˜ëŠ” Web Speech APIì˜ ìŒì„±ì¸ì‹ ì‹ ë¢°ë„(í•œêµ­ì–´, 92%)ì„ í™•ì¸ í›„ í•´ë‹¹ API ì‚¬ìš©ì— ì ‘ê·¼



> CSR = Naver CLOVA Speech Recognition, K_TTS = Kakao Speech-to-Text system, WSA = Web Speech API



![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 12.48.59](README.assets/mdn.png)

#### Web Speech API ì„ ì •

* í•œêµ­ì–´ ì‹ ë¢°ë„ ìˆœì€ CSR > K_TTS > Web Speech API

* ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë¡œì§ìˆœì„œëŠ”

  * CSR, K_TTSì˜ ê²½ìš°,
    * Template(ì‚¬ìš©ì ìŒì„± ë…¹ìŒ) > Axios(JS, íŒŒì¼ë¡œ ë³€í™˜ í›„ ì „ì†¡) > CSR, K_TTS(ë°ì´í„° ì²˜ë¦¬í›„ Response) > Axios(ë°ì´í„° ìˆ˜ì‹ ) > Django View(ë°ì´í„° ì „ì†¡) > Django View(ë°ì´í„° ì²˜ë¦¬ í›„ Response) > Axios(ì‘ì—… í›„ Templateì²˜ë¦¬)
  * WSAì˜ ê²½ìš°,
    * ì‚¬ìš©ì ìŒì„± ë…¹ìŒ(Template) > WSA(ë°”ë¡œ ì²˜ë¦¬ í›„ í…ìŠ¤íŠ¸ ì¶”ì¶œ í›„ ì „ì†¡)  > Django View(ë°ì´í„° ì²˜ë¦¬ í›„ Response) > Axos(ì‘ì—… í›„ Templateì²˜ë¦¬)

  ì•ˆ ê·¸ë˜ë„ ë§ì€ ë°ì´í„°ê°€ ì—…ë¡œë“œ ë˜ì–´ì•¼í•˜ê³ , í†µì‹ ë„ ë§ì´ í•˜ëŠ” ì‚¬ì´íŠ¸ì—ì„œ CSR, K_TTS ë³´ë‹¤ëŠ” WSAê°€ í›¨ì”¬ ê°€ë²¼ìš¸ ê²ƒì´ë¼ ì˜ˆì¸¡

* êµ¬í˜„ ì‚¬ì´íŠ¸ì—ì„œ í•„ìš”í•œ ê²ƒì€ ì–´ëŠì •ë„ì˜ ì¸ì‹ë¥  ì´ìƒ

  ìŒì„±ì¸ì‹ ì²˜ë¦¬ê°€ ëª©ì ì¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹ˆë©°, ì²˜ë¦¬í•´ì•¼í•˜ëŠ” ìš”ì²­ì´ ë§ì§€ ì•Šì•˜ë‹¤. ë”°ë¼ì„œ WSAì˜ ì‹ ë¢°ë„ 92%ëŠ” ì¶©ë¶„í•˜ë‹¤ê³  íŒë‹¨



![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 12.58.12](README.assets/voice.png)



#### HTML - Modal ì´ìš©, íŒì—… í˜¸ì¶œ

ë…¹ìŒ ì•„ì´ì½˜ / ì •ì§€ ì•„ì´ì½˜ ê¸°ì¤€ìœ¼ë¡œ ë…¹ìŒ ì‹œì‘ / ì •ì§€ ë° ë¡œì§ ì‹œì‘ì„ Flag ì²˜ë¦¬

> ì²˜ë¦¬ë§ˆë‹¤ ì•„ì´ì½˜ ë° Answer Text ë³€ê²½

```html
<div>
  <h4 id="voiceText"> ìŒì„±ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”...</h4>
  <h4 class="d-none" id="voiceAnswer" > ì•Œê² ì–´ìš”, ì§€ê¸ˆ ë°”ë¡œ ì‹¤í–‰í• ê²Œìš”.</h4>
</div>

<div class="modal-footer">
  <button id="voiceBtn" type="button" class="btn btn-danger">
    <i class="fas fa-microphone-alt"></i>
  </button>
</div>
```



#### WebRecognitionAPI & Axios & Python

* CDN - Webkit ì•ˆì— ë‚´ì¥

* Instance - new webkitSpeechRecognition

* í…ìŠ¤íŠ¸ ì¶”ì¶œ - Instance 'result' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ, event['results']ì˜ index 0

* í…ìŠ¤íŠ¸ ì¶”ì¶œ í›„ ë¡œì§
  * voice_processë¡œ Axios ìš”ì²­ 
  * vocie_process ì²˜ë¦¬ í›„ Response
  * Axiosì—ì„œ jsë¡œ template ì¡°ì •

##### Voice Recognition Script

```javascript
{% comment %} ìŒì„±ì¸ì‹ {% endcomment %}
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>
    // Required Definition
    const voiceBtn = document.querySelector('#voiceBtn')
    const voiceText = document.querySelector('#voiceText')
    const processURL = '/movies/voice_process/'
    const voiceAnswer = document.querySelector('#voiceAnswer')

    let speech = new webkitSpeechRecognition // Voice Recording Tool
    let flag = true // start|stop flag

    voiceBtn.addEventListener('click', function () {
      if (flag) {
        speech.start()
        voiceText.innerText = "ë“£ê³  ìˆì–´ìš”..."
        voiceBtn.innerHTML = '<i class="fas fa-stop" style="font-size:35px;"></i>'
        voiceAnswer.classList.add('d-none')
        flag = false
      } else {
        speech.stop()
        voiceBtn.innerHTML = '<i class="fas fa-microphone-alt" style="font-size:35px;"></i>'
        flag = true
        
        // Connecting to voice_process in View
        axios({
          method: 'GET',
          url: processURL,
          params: {
            data: voiceText.textContent,
          }
        })
          .then(function (response) {
            const res = response.data.res // Number for Recognition
            if (res != 0 && res <= 3) {
                // href to Main by Sorting
              voiceAnswer.classList.remove('d-none')
              voiceAnswer.innerText = "ì•Œê² ì–´ìš”, ë°”ë¡œ ì‹¤í–‰í• ê²Œìš”."
              setTimeout(function() {
                window.location.href = `/movies/index/${res}`
              }, 1000);  
            } else if (res >= 4) {
              if (res == 4) {
                // Search
                let query = response.data.query
                const searchInput = document.querySelector('#searchInput')
                const searchButton = document.querySelector('#searchButton')
                searchInput.value = query
                voiceAnswer.classList.remove('d-none')
                voiceAnswer.innerText = "ì•Œê² ì–´ìš”, ë°”ë¡œ ì‹¤í–‰í• ê²Œìš”."
                setTimeout(function() {
                  searchButton.click()
                }, 1000);
              } else if (res == 5) {
                // Click BackBtn
                voiceAnswer.classList.remove('d-none')
                voiceAnswer.innerText = "ì•Œê² ì–´ìš”, ë°”ë¡œ ì‹¤í–‰í• ê²Œìš”."
                setTimeout(function() {
                  let backTag = document.querySelector('#backTag')
                  backTag.click()
                }, 1000);
              } else if (res == 6) {
                // About UserInfo Update
                voiceAnswer.classList.remove('d-none')
                voiceAnswer.innerText = "ì•Œê² ì–´ìš”, ë°”ë¡œ ì‹¤í–‰í• ê²Œìš”."
                setTimeout(function() {
                window.location.href = '/accounts/logout'
              }, 1000);
              }
            } else {
              voiceAnswer.classList.remove('d-none')
              voiceAnswer.innerText = "í•´ë‹¹ ì„œë¹„ìŠ¤ëŠ” ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤."
            }
          })
        }})
    
    // Recording Response Tracking
    speech.addEventListener("result", function (event) {
      const { transcript } = event["results"][0][0]
      voiceText.innerText = `"${transcript}"`
    })
  </script>
```

#### 

##### voice_process

```python
# movies/views.py

def voice_process(request):
    data = request.GET['data']
    responsable = {"ë©”ì¸": 1, "ë§¤ì¸": 1, "ìƒ‰ì²´": 1, "ìƒ‰ì±„": 1, "í‰ì ": 2, "ìµœì‹ ": 3, "ê²€ìƒ‰": 4, "ë’¤ë¡œ":5, "ë¡œê·¸": 6}
    res, query = 0, ""
    
    for key, value in responsable.items():
        if key in data:
            if key == "ê²€ìƒ‰":
                query = str(data[1:data.index("ê²€ìƒ‰")])
            res = value
            break
        
    context = {
        'res' : res,
        'query' : query,
    }
    return JsonResponse(context)
```





### `ë“œë¡œì‰`

> ì‚¬ìš©ì ë¡œì»¬ì— ì €ì¥í•˜ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ë°”ë¡œ ì „ì†¡í•˜ê¸° ìœ„í•´ Blob ë°ì´í„° ë³€í™˜ í›„, FormData ìƒì„± í›„ Views.py ì²˜ë¦¬, Json Response, Axios Promise ë™ì‘



##### ê·¸ë¦¼íŒ

* https://github.com/shlee0882/painting-js ì´ìš© ë° ì‘ìš©
* ì‚¬ìš©ìê°€  ê·¸ë¦´ ìˆ˜ ìˆëŠ” ì»¬ëŸ¬ëŠ” ì˜í™”ì˜ ì»¬ëŸ¬ ìƒ‰ìƒìœ¼ë¡œ í•œì •

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 1.19.55](README.assets/draw.png)



##### HTML - Modal ì´ìš©, íŒì—… í˜¸ì¶œ

ìŠ¤ì¼€ì¹˜ë¶ ì—´ê¸° ë²„íŠ¼ì„ í†µí•´ ê·¸ë¦¼íŒ display í† ê¸€

> í•´ë‹¹ flagë¡œ ê·¸ë¦¼ ë°ì´í„° ì—†ì„ ê²½ìš° ê·¸ë¦¼ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ ì²˜ë¦¬

```html
<div class="content-section mt-3">
  <div class="app-card mt-5">
    <button style="background: none; border:none;" id="drawBtn">
      <h1 style="color:white;">ìŠ¤ì¼€ì¹˜ë¶ ì—´ê¸°</h1>
    </button>
  </div>
</div>

<div class="content-section d-none" id="drawWindow">
  <div class="app-card mt-3">
    <div class="row d-flex justify-content-center align-items-center">
      <canvas id="drawCanvas" class="canvas col-6" style="opacity: 0.8;"></canvas>
      <div class="controls col-5">
        <div class="controls__range">
          <input type="range" id="jsRange" min="0.1" max="10.0" value="5.0" step="0.1" style="width:200"/>
        </div>
        <!-- div.controls__btns>button#jsMode+button#jsSave -->
        <div class="controls__btns">
          <button id="jsMode" style="opacity: 0.8;">íœ</button>
        </div>
        <div class="controls__colors" id="jsColors">
          {% for color in movie.color_set.all %}
          <div class="controls__color jsColor" style="background-color: rgb({{color.color_1_R}},{{color.color_1_G}},{{color.color_1_B}});"></div>
          <div class="controls__color jsColor" style="background-color: rgb({{color.color_2_R}},{{color.color_2_G}},{{color.color_2_B}});"></div>
          <div class="controls__color jsColor" style="background-color: rgb({{color.color_3_R}},{{color.color_3_G}},{{color.color_3_B}});"></div>
          <div class="controls__color jsColor" style="background-color: rgb({{color.color_4_R}},{{color.color_4_G}},{{color.color_4_B}});"></div>
          <div class="controls__color jsColor" style="background-color: rgb({{color.color_5_R}},{{color.color_5_G}},{{color.color_5_B}});"></div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
```



##### Draw Script

* Reference - https://github.com/shlee0882/painting-js)
* Reference ê·¸ëŒ€ë¡œ ì´ìš©, ê·¸ë¦¼íŒì„ ìƒì„±í•˜ëŠ” ê²ƒì´ ëª©í‘œê°€ ì•„ë‹ˆì˜€ìœ¼ë¯€ë¡œ ì˜¤í”ˆì†ŒìŠ¤ CSS í™œìš©ê³¼ ê°™ë‹¤ê³  íŒë‹¨



##### Blob ë°ì´í„° ë³€í™˜ & FormData ìƒì„± & Axios

* Blob ë°ì´í„° ë³€í™˜ ë° FormData ìƒì„± ì´ìœ 
  * ì‚¬ìš©ì ë¡œì»¬ì— ì €ì¥í•˜ì§€ ì•Šê³  íŒŒì¼ì„ ë¯¸ë””ì–´ íŒŒì¼ì— ì—…ë¡œë“œ >> Blob ë°ì´í„° ë³€í™˜ í›„ ë°ì´í„° PUSH
  * inputì— ë°ì´í„° ê°’ì„ JSë¡œ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ì •ì±… >> ìƒˆë¡œìš´ FormData ìƒì„±í›„ í•´ë‹¹ ë°ì´í„° POST

```javascript
function submitFunc(){
  event.preventDefault()
  let drawCanvas = document.querySelector('#drawCanvas')
	
  data = new FormData()                                                           	// FormData ìƒì„±
	

  var imgDataUrl = drawCanvas.toDataURL('image/png');
  var binaryData = atob(imgDataUrl.split(',')[1]);                           	 	   // Blob ë°ì´í„° ë³€í™˜
  var array = [];
  for (var i = 0; i < binaryData.length; i++) {
    array.push(binaryData.charCodeAt(i));
  }
  var blob = new Blob([new Uint8Array(array)], {type: 'image/png'});


  const title = document.querySelector('#title')
  const content = document.querySelector('#content')
  const moviePk = "{{movie.pk}}"
  if (drawBtnFlag) {
  } else {
    data.set('draw', blob, 'my_draw.png')
  }
  data.set('title', title.value)
  data.set('content', content.value)
	
  axios({                                                           								// Axios
    url: '',
    method: 'POST',
    data: data,
    headers: {"X-CSRFToken": csrfToken, "Content-Type": "multipart/form-data" },
  })
    .then(response => {
      window.location.href = `/movies/detail/${moviePk}/`
    })
    .catch(err => {
      alert("ì‘ì„± ê°’ì— ì´ìƒì´ ìˆì–´ìš”")
    })
}
```

#### 

##### review_create / quiz_create

```python
@login_required
@require_http_methods(['GET','POST'])
def review_create(request, movie_pk):
    movie = Movie.objects.get(pk = movie_pk)
    
    # Profile Color Create
    colors = request.user.usercolorrecord_set.all()                # Color List
    last_color = colors[len(colors)-1]                             # Picked Color
    colors = reversed(colors)                                      # Color Sort(Recently)
    
    if request.method == "POST":
        form = ReviewForm(request.POST, request.FILES)
        if form.is_valid():
            review = form.save(commit=False)
            review.movie = movie
            review.user = request.user
            review.save()
            request.user.point += 30
            request.user.save()
            return redirect('movies:detail', movie_pk)
    else:
        form = ReviewForm()
    context = {
        'movie': movie,
        'form': form,
        'last_color': last_color,
        'colors': colors,
    }
    return render(request, 'movies/review_create.html', context)
  
@login_required
@require_http_methods(['GET','POST'])
def quiz_create(request):
    # Profile Color Create
    colors = request.user.usercolorrecord_set.all()                # Color List
    last_color = colors[len(colors)-1]                             # Picked Color
    colors = reversed(colors)                                      # Color Sort(Recently)
    
    movies = Movie.objects.all()
    
    if request.method == "POST":
        form = QuizForm(request.POST, request.FILES)
        if form.is_valid():
            quiz = form.save(commit=False)
            quiz.user = request.user
            quiz.save()
            request.user.point += 30
            request.user.save()
            return redirect('movies:index', 2)
    else:
        form = QuizForm()
    context = {
        'form': form,
        'last_color': last_color,
        'colors': colors,
        'movies': movies,
    }
    return render(request, 'movies/quiz_create.html', context)
```



### `Quiz`

##### í€´ì¦ˆ í’€ì´ í™”ë©´

* ì‚¬ìš©ìë³„ë¡œ ë§ì¶˜ ë¬¸ì œëŠ” ë³´ì´ì§€ ì•ŠìŒ

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 2.31.29](README.assets/quiz.png)

* Axiosì™€ quiz_check(views.py) ì²˜ë¦¬

> ë¬¸ì œì˜ pkì™€ ì œì¶œëœ value pk ë¥¼ ë¹„êµ

* JS Code

```javascript
{% block option_js %}
<script>
  const forms = document.querySelectorAll("#answerForm")
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value

  for(const form of forms){
    form.addEventListener("submit", function (event) {
      event.preventDefault()
      const questionPk = event.target.dataset.questionPk
      const answer = event.submitter.value

      axios({
        method: 'post',
        url: '/movies/quiz_check/',
        headers: {'X-CSRFToken': csrfToken},
        data: {
          test: "Test",
          question_pk: `${questionPk}`,
          answer: `${answer}`,
        }
      })
        .then(function (res) {
          const correct = res.data.correct
          const main = document.querySelector(`#main${questionPk}`)
          const right = document.querySelector(`#right${questionPk}`)
          const wrong = document.querySelector(`#wrong${questionPk}`)

          if (correct) {
            main.classList.add('d-none')
            right.classList.remove('d-none')
          } else {
            main.classList.add('d-none')
            wrong.classList.remove('d-none')
          }
        })
        .catch(function (err) {
          console.log(err)
        })
    })
  } 
</script>
{% endblock option_js %}
```

* quiz_check.py

```python
@login_required
@require_http_methods(['GET','POST'])
def quiz_check(request):
    post_body = json.loads(request.body.decode('utf-8'))
    
    question_pk = post_body.get('question_pk')
    answer = post_body.get('answer')

    quiz = Quiz.objects.get(pk=question_pk)
    correct = False

    if int(quiz.movie.pk) == int(answer):
        print("ì •ë‹µ")
        correct = True
        
        request.user.point += 20
        quiz.correct_user.add(request.user)
        request.user.save()

    context = {
        "correct": correct,
    }

    return JsonResponse(context)
```



##### í€´ì¦ˆ ë§Œë“¤ê¸° í™”ë©´

* ì˜í™” ì„ íƒ í›„, ë¬¸ì œë¥¼ ê·¸ë¦¼íŒìœ¼ë¡œ ê·¸ë¦¬ê³  ë°”ë¡œ ì¶œì œ ê°€ëŠ¥

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 2.31.43](README.assets/quiz_create.png)

* ì½”ë“œ  - ìƒë‹¨ ë“œë¡œì‰ ì°¸ì¡°



##### í€´ì¦ˆ ë²„íŠ¼ ì œì¶œì‹œ(ë¹„ë™ê¸° ì—…ë°ì´íŠ¸)

* ë§ì¶”ê³  í‹€ë¦° ê²ƒì— ë”°ë¼ í•´ë‹¹ ë¬¸ì œê°€ ì²´í¬ë˜ê³  ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ì„ ë‚´ë¦´ ìˆ˜ ìˆë„ë¡ UI êµ¬ì„±
* classList.add / remove d-none + promise ë™ì‘ë°©ì‹ìœ¼ë¡œ êµ¬ì„±

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 2.32.42](README.assets/right.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 2.31.54](README.assets/wrong.png)



### `DB`

> ColorData, TMDB API(ì˜í™” ì •ë³´), Youtube Data(trailer) ë“±ì´ ë“¤ì–´ê°ì— ë”°ë¼ ìƒˆë¡œìš´  DBë¥¼ ë§Œë“¤ í•„ìš”



##### DB Modeling

* ê¸°ëŠ¥ê³¼ ë“¤ì–´ê°ˆ ë°ì´í„°ê°€ ë§ì€ ë§Œí¼ ê·œëª¨ê°€ ìˆëŠ” DataBase ìƒì„±
* BASE ë°ì´í„°ì¸ ì˜í™”ë°ì´í„°ëŠ” ì§ì ‘ ì¡°í•©í•´ì„œ PUSH í•´ì•¼í•  í•„ìš”
  * í´ëŸ¬ìŠ¤í„°ë§ ë° RGB ë„ì¶œëœ ë°ì´í„°
  * TMDB API ì˜í™”ì •ë³´
  * Youtube Trailer URL ë“±

![erd](README.assets/erd-7816963.png)



##### Frame ì´ë¯¸ì§€ PUSH

![color_url_push](README.assets/color_url_push.png)



##### Color Model Database PUSH

* ë§Œë“¤ì–´ì§„ json ë°ì´í„°ë¥¼ Movieë¥¼ ì •ì°¸ì¡° í•˜ê³  ìˆëŠ” Color ëª¨ë¸ì— PUSH

* íŠ¹ì •ìƒ 5ê°œ RGB ë°ì´í„° PUSH
* ìš”ì†Œê°€ ë§ìœ¼ë¯€ë¡œ ì‘ì—… ì „ Python ì´ìš©
* ![datastringmake](README.assets/datastringmake.png)

![makecolorsdata](README.assets/makecolorsdata.png)

* Result

![res](README.assets/res.png)



##### TMDB API í˜¸ì¶œ ë° í•´ë‹¹ ë°ì´í„° PUSH

* Response ë°ì´í„°

* ![json](README.assets/json.png)

![for](README.assets/for.png)



##### ê¸°ì¡´ì— Naver í‰ì ì„ API í˜¸ì¶œí•˜ë ¤ í–ˆìœ¼ë‚˜, ì˜í™”ì œëª© í¬í•¨ì—¬ë¶€ë¡œ responseë¥¼ ì£¼ì–´ì„œ TMDB í‰ì ìœ¼ë¡œ ë³€ê²½

* Naver

![naver](README.assets/naver.png)

* TMDB

![requests](README.assets/requests.png)

* Result

![res2](README.assets/res2.png)

![result2](README.assets/result2.png)



##### Youtube Trailer Link PUSH

* Iframe ì˜ˆê³ í¸ ì‘ì—… ì „ link PUSH

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-23 á„‹á…©á„’á…® 7.11.11](README.assets/iframe.png)



### `Query ìµœì í™”`

> ë³µì¡í•œ ëª¨ë¸êµ¬ì¡°ë¡œ ì—­ì°¸ì¡°, ì •ì°¸ì¡° ë¶€ë¶„ì—ì„œ ì¤‘ë³µ Query ë°œìƒ



##### Query ìµœì í™” ì‘ì—… ì „ Index Page

* 408 Query / Time 7000ms ~ 9000ms

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-22 á„‹á…©á„Œá…¥á†« 10.25.55](README.assets/query1.png)



##### Query ìµœì í™” ì‘ì—… í›„ Index Page

* 9 Query / Time 250ms ~ 300ms (ì•½ Query 1/40, Time 1/30 ìœ¼ë¡œ ê²½ëŸ‰í™”)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-22 á„‹á…©á„Œá…¥á†« 11.44.30](README.assets/query2.png)



##### ì‚¬ìš© Stack

* ##### prefetched_realated - (ì—­ì°¸ì¡° ë°ì´í„° ì‚¬ì „ ë“±ë¡)

* ##### annotate - (count ì‚¬ì „ ë“±ë¡)

* ##### filter, exclude ë“± - ê³„ì‚° ìµœì í™”

```python
# index/views.py

    # Exclude Already Watched Movies(Query Optimization)
    already_watched_movies = set()

    users_moviecomments = MovieComment.objects.filter(user=request.user.pk).values('movie')
    for users_moviecomment in users_moviecomments:
        already_watched_movies.add(users_moviecomment['movie'])

    users_reviews = Review.objects.filter(user=request.user.pk).values('movie')
    for users_review in users_reviews:
        already_watched_movies.add(users_review['movie'])

    # Query Optimization - movie.color_set + Exclude Already Watched Movies + movie.comments_set + movie.comments.all.count()
    movies = Movie.objects.prefetch_related('color_set','comments')\
            .annotate(comment_count=Count('comments'))\
            .exclude(id__in=already_watched_movies)
    
    res_movies = []
    
    # Order by TMDB_Grade + User_Grade
    if mode == 2:
        for movie in movies:
            naver_score = movie.naver_grade
            user_score = 0 
            for comment in movie.comments.all():
                user_score += comment.grade
            if user_score:
                user_score = round((user_score / movie.comment_count),1) * 2
                score = (naver_score + user_score) / 2
            else:
                score = naver_score
            res_movies.append([movie, score])
    
    # Order by Release Date
    elif mode == 3:
        for movie in movies:
            score = movie.release_date
            res_movies.append([movie, score])
    
    # Order by Search
    elif mode == 4:
        datas = request.GET['searchData'].split()                      # Input Data list
        for movie in movies:                                           # query in title : +10, query in overview +1
            temp_cnt = 0
            title = movie.title
            overview = movie.overview
            for data in datas:
                if data in title:
                    temp_cnt += 10
                if data in overview:
                    temp_cnt += 1
            if temp_cnt >= 1:                                          # If query in title, content, Can be Searched
                res_movies.append([movie,temp_cnt])

```



### `ë°°í¬`

> AWS EC2(Ubuntu Server 18.04 LTS), Cloud9, Gunicorn, NGINX
>
> Django contains STATIC / MEDIA
>
> ##### https://www.prismfilmstudio.com

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 3.29.14](README.assets/aws.png)



##### NGINX ì„¤ì •

* staticê³¼ media filesê°€ í¬í•¨ë˜ì–´ ìˆì–´ NGINXì—ì„œ ì ‘ê·¼í•˜ì§€ ëª»í•˜ëŠ” ì´ìŠˆê°€ ë°œìƒ(404)
* staticì€ ê²½ë¡œë¥¼  staticfiles/staticìœ¼ë¡œ ì¡ì•„ì¤˜ì„œ staticfiles/static ê²½ë¡œë¥¼ ë§Œë“¤ì–´ ì¤Œìœ¼ë¡œì¨ í•´ê²°
* media íŒŒì¼ ì ‘ê·¼ì˜ ê²½ìš°ì—ëŠ” static ì²˜ëŸ¼ rootë¡œ ì¡ì•„ì£¼ë©´ ì—ëŸ¬ê°€ ë°œìƒ
  * aliasë¡œ ë°”ê¿” mediaíŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬

```shell
   server_name 18.214.88.219 prismfilmstudio.com www.prismfilmstudio.com;

    location ^~ /static/ {
            root /home/ubuntu/pjt10/staticfiles/;
    }

    location ^~ /media/ {
            alias /home/ubuntu/pjt10/media/;
    }

    location / {
            include proxy_params;
            proxy_pass http://127.0.0.1:8000;
    }

listen 443 ssl; # managed by Certbot
ssl_certificate /etc/letsencrypt/live/prismfilmstudio.com/fullchain.pem; # managed by Certbot
ssl_certificate_key /etc/letsencrypt/live/prismfilmstudio.com/privkey.pem; # managed by Certbot
```



##### Django & Gunicorn ì„¤ì •

* Django - STATIC ROOT, ALLOWED_HOSTS, collectstatic ëª…ë ¹
* Gunicorn ì„¤ì •

```shell
[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/pjt10
ExecStart=/home/ubuntu/pjt10/venv/bin/gunicorn \
        --workers 3 \
        --bind 127.0.0.1:8000 \
        pjt10.wsgi:application

[Install]
WantedBy=multi-user.target
```



##### ë„ë©”ì¸ ì„¤ì • & í¬íŠ¸ ì„¤ì • & HTTPS

* www.~ ìœ¼ë¡œë„ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë„ë¡ A type í•˜ë‚˜ ë” ê°œë°© 

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 3.40.07](README.assets/domain.png)

* í•´ë‹¹ ì„¤ì •ì— ë”°ë¥¸ NGINX ì„¤ì •
* HTTPS ì„¤ì •

```shell
sudo snap install core; sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
sudo certbot --nginx
```

* í¬íŠ¸ì„¤ì •

* 80 / 8000 / 443(https) => 0.0.0.0/0 / ::/0 ê°œë°©

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-25 á„‹á…©á„’á…® 3.44.55](README.assets/port.png)







## ğŸ“– Reference
formdata - https://developer.mozilla.org/ko/docs/Web/API/FormData

ê·¸ë¦¼íŒ - https://github.com/shlee0882/painting-js

blob Data ë³€í™˜ - https://codebb.tistory.com/22

ë°°ê²½ í…Œë§ˆ - https://codepen.io/trending

Axios - https://github.com/axios/axios

Base -  https://edu.ssafy.com

ì»¬ëŸ¬ë°”ì½”ë“œ - https://happycoding.io/gallery/movie-colors/index

ëŒ€í‘œ ìƒ‰ì±„ - https://airows.com/culture/color-palettes-from-famous-movie-scenes

í‹°ì–´ ì‹œìŠ¤í…œ - https://www.acmicpc.net/, https://solved.ac/
